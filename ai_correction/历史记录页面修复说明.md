# å†å²è®°å½•é¡µé¢ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**: `Error: Cannot read properties of undefined (reading 'language')`

**é”™è¯¯ä½ç½®**: `frontend/app/history/page.tsx` ç¬¬640è¡Œ

**æ ¹æœ¬åŸå› **: ä»£ç å°è¯•è®¿é—® `selectedRecord.settings.language`ï¼Œä½† `selectedRecord.settings` å¯èƒ½ä¸º `undefined`

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. æ‰¹æ”¹è®¾ç½®å®‰å…¨è®¿é—®
**ä¿®å¤ä½ç½®**: ç¬¬640-644è¡Œ

**ä¿®å¤å‰**:
```typescript
<p>è¯­è¨€: {getLanguageName(selectedRecord.settings.language)}</p>
<p>ä¸¥æ ¼ç¨‹åº¦: {selectedRecord.settings.strictness_level}</p>
{selectedRecord.settings.groups_processed && (
  <p>å¤„ç†ç»„æ•°: {selectedRecord.settings.groups_processed}</p>
)}
```

**ä¿®å¤å**:
```typescript
<p>è¯­è¨€: {getLanguageName(selectedRecord.settings?.language || 'zh')}</p>
<p>ä¸¥æ ¼ç¨‹åº¦: {selectedRecord.settings?.strictness_level || 'ä¸­ç­‰'}</p>
{selectedRecord.settings?.groups_processed && (
  <p>å¤„ç†ç»„æ•°: {selectedRecord.settings.groups_processed}</p>
)}
```

**æ”¹è¿›ç‚¹**:
- ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦ (`?.`) å®‰å…¨è®¿é—®åµŒå¥—å±æ€§
- æä¾›é»˜è®¤å€¼é˜²æ­¢ undefined é”™è¯¯
- è¯­è¨€é»˜è®¤ä¸º 'zh' (ä¸­æ–‡)
- ä¸¥æ ¼ç¨‹åº¦é»˜è®¤ä¸º 'ä¸­ç­‰'

### 2. æ–‡ä»¶ä¿¡æ¯å®‰å…¨è®¿é—®
**ä¿®å¤ä½ç½®**: ç¬¬649-654è¡Œ

**ä¿®å¤å‰**:
```typescript
{Object.entries(selectedRecord.files).map(([key, file]: [string, any]) => (
  <p key={key}>
    {getFileTypeIcon(file.original_name || '')} {file.original_name}
  </p>
))}
```

**ä¿®å¤å**:
```typescript
{(() => {
  if (!selectedRecord.files) {
    return <p className="text-gray-500">æ— æ–‡ä»¶ä¿¡æ¯</p>;
  }
  
  if (Array.isArray(selectedRecord.files)) {
    return selectedRecord.files.map((file: any, index: number) => (
      <p key={index}>
        {getFileTypeIcon(file?.original_name || file?.filename || '')} 
        {file?.original_name || file?.filename || 'æœªçŸ¥æ–‡ä»¶'}
      </p>
    ));
  }
  
  if (typeof selectedRecord.files === 'object') {
    return Object.entries(selectedRecord.files).map(([key, file]: [string, any]) => (
      <p key={key}>
        {getFileTypeIcon(file?.original_name || file?.filename || '')} 
        {file?.original_name || file?.filename || 'æœªçŸ¥æ–‡ä»¶'}
      </p>
    ));
  }
  
  return <p className="text-gray-500">æ— æ–‡ä»¶ä¿¡æ¯</p>;
})()}
```

**æ”¹è¿›ç‚¹**:
- æ£€æŸ¥ `selectedRecord.files` æ˜¯å¦å­˜åœ¨
- æ”¯æŒæ•°ç»„å’Œå¯¹è±¡ä¸¤ç§æ–‡ä»¶æ•°æ®æ ¼å¼
- ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦å®‰å…¨è®¿é—®æ–‡ä»¶å±æ€§
- æ”¯æŒå¤šç§æ–‡ä»¶åå­—æ®µ (`original_name`, `filename`)
- æä¾›å‹å¥½çš„é”™è¯¯æç¤º

## âœ… ä¿®å¤æ•ˆæœ

### é”™è¯¯é˜²æŠ¤
- âœ… é˜²æ­¢ `undefined` å±æ€§è®¿é—®é”™è¯¯
- âœ… æä¾›åˆç†çš„é»˜è®¤å€¼
- âœ… æ”¹å–„ç”¨æˆ·ä½“éªŒ

### å…¼å®¹æ€§æ”¹è¿›
- âœ… æ”¯æŒä¸åŒçš„æ•°æ®ç»“æ„æ ¼å¼
- âœ… å‘åå…¼å®¹æ—§çš„è®°å½•æ ¼å¼
- âœ… å¤„ç†ç¼ºå¤±æ•°æ®çš„æƒ…å†µ

### ç”¨æˆ·ä½“éªŒ
- âœ… æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
- âœ… ä¿æŒç•Œé¢ç¨³å®šæ€§
- âœ… é¿å…é¡µé¢å´©æºƒ

## ğŸ§ª æµ‹è¯•å»ºè®®

1. **è®¿é—®å†å²è®°å½•é¡µé¢**ï¼šç¡®ä¿é¡µé¢æ­£å¸¸åŠ è½½
2. **æŸ¥çœ‹æ‰¹æ”¹è¯¦æƒ…**ï¼šç‚¹å‡»è®°å½•æŸ¥çœ‹è¯¦æƒ…å¯¹è¯æ¡†
3. **æ£€æŸ¥æ•°æ®æ˜¾ç¤º**ï¼šéªŒè¯è®¾ç½®å’Œæ–‡ä»¶ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
4. **æµ‹è¯•è¾¹ç•Œæƒ…å†µ**ï¼šæµ‹è¯•æ²¡æœ‰è®¾ç½®æˆ–æ–‡ä»¶ä¿¡æ¯çš„è®°å½•

## ğŸ“‹ æŠ€æœ¯è¦ç‚¹

- **å¯é€‰é“¾æ“ä½œç¬¦** (`?.`): å®‰å…¨è®¿é—®å¯èƒ½ä¸å­˜åœ¨çš„å±æ€§
- **é€»è¾‘æˆ–æ“ä½œç¬¦** (`||`): æä¾›é»˜è®¤å€¼
- **ç±»å‹æ£€æŸ¥**: ä½¿ç”¨ `typeof` å’Œ `Array.isArray()` æ£€æŸ¥æ•°æ®ç±»å‹
- **IIFE**: ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼å¤„ç†å¤æ‚é€»è¾‘

è¿™ä¸ªä¿®å¤ç¡®ä¿äº†å†å²è®°å½•é¡µé¢åœ¨é¢å¯¹ä¸å®Œæ•´æˆ–æ ¼å¼ä¸ä¸€è‡´çš„æ•°æ®æ—¶ä»èƒ½æ­£å¸¸å·¥ä½œï¼Œæé«˜äº†åº”ç”¨çš„å¥å£®æ€§å’Œç”¨æˆ·ä½“éªŒã€‚ 