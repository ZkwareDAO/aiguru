# 登录问题解决指南

## 问题现象
用户在登录页面输入 `testuser` / `123456` 后，出现 "Failed to fetch" 错误。

## 问题原因分析
"Failed to fetch" 错误通常表示前端无法连接到后端服务，可能的原因包括：

1. **后端服务未启动** - 最常见的原因
2. **端口冲突** - 8000端口被其他程序占用
3. **防火墙阻止** - 系统防火墙阻止了连接
4. **网络配置问题** - 代理或网络设置问题

## 解决方案

### 🔧 方案一：使用启动脚本（推荐）

1. **双击运行** `start_backend.bat` 文件
2. 脚本会自动：
   - 检查Python环境
   - 检查项目文件
   - 清理端口占用
   - 启动后端服务

3. 看到以下信息表示启动成功：
   ```
   🚀 正在启动FastAPI服务器...
   📝 服务地址: http://localhost:8000
   💡 测试账户: testuser / 123456
   ```

### 🔧 方案二：手动启动后端

1. **打开命令提示符或PowerShell**
2. **导航到项目目录**：
   ```bash
   cd D:\project\aiguru\ai_correction
   ```

3. **启动后端服务**：
   ```bash
   python main.py
   ```

4. **确认服务启动**：
   - 看到类似信息：`Uvicorn running on http://0.0.0.0:8000`
   - 或访问：http://localhost:8000/health

### 🔧 方案三：端口冲突处理

如果端口8000被占用：

1. **查找占用进程**：
   ```bash
   netstat -ano | findstr :8000
   ```

2. **终止占用进程**：
   ```bash
   taskkill /pid [进程ID] /f
   ```

3. **重新启动服务**

### 🔧 方案四：使用诊断工具

运行诊断脚本：
```bash
python diagnose_backend.py
```

诊断工具会检查：
- Python环境
- 依赖包安装
- 端口占用情况
- 后端连接状态
- 登录功能测试

## 验证步骤

### 1. 确认后端服务正常
访问：http://localhost:8000/health
- ✅ 正常：返回 `{"status": "healthy"}`
- ❌ 异常：无响应或错误信息

### 2. 测试登录API
使用浏览器开发者工具或Postman测试：
```
POST http://localhost:8000/api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "123456"
}
```

- ✅ 正常：返回访问令牌
- ❌ 异常：返回错误信息

### 3. 前端登录测试
1. 访问：http://localhost:3000/auth
2. 输入：`testuser` / `123456`
3. 或点击"使用测试账户快速登录"

## 常见错误及解决

### 错误1：Python不是内部或外部命令
**原因**：Python未安装或未添加到PATH
**解决**：
1. 安装Python 3.8+
2. 安装时勾选"Add Python to PATH"
3. 或手动添加Python到系统PATH

### 错误2：ModuleNotFoundError
**原因**：缺少依赖包
**解决**：
```bash
pip install fastapi uvicorn python-multipart python-jose[cryptography] passlib[bcrypt]
```

### 错误3：端口已被占用
**原因**：8000端口被其他程序占用
**解决**：
1. 找到占用进程并终止
2. 或修改main.py中的端口号

### 错误4：CORS错误
**原因**：跨域请求被阻止
**解决**：确认main.py中CORS设置包含前端地址

## 完整启动流程

### 启动后端服务
1. 双击 `start_backend.bat`
2. 或运行 `python main.py`
3. 确认看到启动信息

### 启动前端服务
1. 打开新的命令提示符
2. 导航到frontend目录
3. 运行 `npm run dev`
4. 访问 http://localhost:3000/auth

### 登录测试
1. 用户名：`testuser`
2. 密码：`123456`
3. 或点击快速登录按钮

## 技术支持

如果以上方案都无法解决问题，请提供以下信息：

1. **系统信息**：
   - 操作系统版本
   - Python版本
   - 浏览器版本

2. **错误信息**：
   - 完整的错误消息
   - 浏览器控制台错误
   - 后端日志信息

3. **网络状态**：
   - 是否使用代理
   - 防火墙设置
   - 网络连接状态

## 预防措施

1. **定期检查**：
   - 后端服务状态
   - 端口占用情况
   - 日志文件大小

2. **环境维护**：
   - 保持Python和依赖包更新
   - 定期清理临时文件
   - 备份重要配置

3. **监控工具**：
   - 使用健康检查接口
   - 设置自动重启机制
   - 配置日志轮转

---

**最后更新**：2025年6月21日  
**适用版本**：v1.0.1+  
**支持平台**：Windows 10/11 