# ç™»å½•ç³»ç»Ÿé—®é¢˜è§£å†³æŠ¥å‘Š

## ğŸ” é—®é¢˜ç°è±¡
ç”¨æˆ·åœ¨ç™»å½•æ—¶é‡åˆ°é”™è¯¯ï¼š`Unexpected token 'I', "Internal S"... is not valid JSON`

## ğŸ¯ é—®é¢˜æ ¹å› 
é€šè¿‡è¯¦ç»†è¯Šæ–­å‘ç°é—®é¢˜å‡ºç°åœ¨ä»¥ä¸‹å‡ ä¸ªå±‚é¢ï¼š

### 1. CORSè·¨åŸŸé—®é¢˜
- **ç°è±¡**ï¼šç›´æ¥è®¿é—®åç«¯APIæ—¶å‡ºç°CORSé”™è¯¯
- **åŸå› **ï¼šåç«¯CORSä¸­é—´ä»¶é…ç½®å¤æ‚ï¼Œå­˜åœ¨å†²çª
- **è§£å†³**ï¼šç®€åŒ–CORSé…ç½®ï¼Œä½¿ç”¨Next.jsä»£ç†ç»•è¿‡è·¨åŸŸé—®é¢˜

### 2. Next.jsä»£ç†é…ç½®
- **ç°è±¡**ï¼šå‰ç«¯è¯·æ±‚é€šè¿‡ä»£ç†è½¬å‘åˆ°åç«¯
- **çŠ¶æ€**ï¼šâœ… ä»£ç†å·¥ä½œæ­£å¸¸
- **é…ç½®**ï¼š`frontend/next.config.js` æ­£ç¡®é…ç½®äº†APIä»£ç†

### 3. åç«¯APIé”™è¯¯å¤„ç†
- **ç°è±¡**ï¼šåç«¯è¿”å›500å†…éƒ¨æœåŠ¡å™¨é”™è¯¯
- **åŸå› **ï¼šç™»å½•APIå¯èƒ½å­˜åœ¨æœªæ•è·çš„å¼‚å¸¸
- **å½±å“**ï¼šè¿”å›HTMLé”™è¯¯é¡µé¢è€Œä¸æ˜¯JSONå“åº”

## âœ… å·²å®Œæˆçš„ä¿®å¤

### åç«¯ä¿®å¤ (main.py)
1. **ç®€åŒ–CORSé…ç½®**
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=False,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

2. **å¢å¼ºç™»å½•APIæ—¥å¿—**
```python
@app.post("/api/auth/login")
async def login(user_data: UserLogin):
    try:
        logging.info(f"æ”¶åˆ°ç™»å½•è¯·æ±‚: {user_data.username}")
        # ... ç™»å½•é€»è¾‘
        logging.info(f"æµ‹è¯•è´¦æˆ·ç™»å½•æˆåŠŸ: {user_data.username}")
        return {"access_token": access_token, "token_type": "bearer", "username": user_data.username}
    except HTTPException:
        raise
    except Exception as e:
        logging.error(f"ç™»å½•APIé”™è¯¯: {str(e)}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"ç™»å½•æœåŠ¡é”™è¯¯: {str(e)}"
        )
```

### å‰ç«¯ä¿®å¤ (frontend/lib/api.ts)
1. **ä½¿ç”¨Next.jsä»£ç†**
```typescript
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || '';
```

2. **ä¿æŒä»£ç†é…ç½®** (frontend/next.config.js)
```javascript
async rewrites() {
  return [
    {
      source: '/api/:path*',
      destination: 'http://localhost:8001/api/:path*',
    },
    {
      source: '/health',
      destination: 'http://localhost:8001/health',
    },
  ]
}
```

## ğŸ”„ å½“å‰çŠ¶æ€
- âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ (ç«¯å£8001)
- âœ… å‰ç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ (ç«¯å£3000)
- âœ… Next.jsä»£ç†å·¥ä½œæ­£å¸¸
- âœ… å¥åº·æ£€æŸ¥é€šè¿‡
- âŒ ç™»å½•APIä»è¿”å›500é”™è¯¯

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. **æ£€æŸ¥åç«¯æ—¥å¿—** - æŸ¥çœ‹å…·ä½“çš„é”™è¯¯ä¿¡æ¯
2. **éªŒè¯JWTä¾èµ–** - ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„åŒ…éƒ½å·²å®‰è£…
3. **æµ‹è¯•ç®€åŒ–ç™»å½•** - åˆ›å»ºæœ€å°åŒ–çš„ç™»å½•æµ‹è¯•
4. **éªŒè¯æ•°æ®åº“è¿æ¥** - ç¡®ä¿ç”¨æˆ·æ•°æ®æ–‡ä»¶æ­£å¸¸

## ğŸ”§ æµ‹è¯•è´¦æˆ·
- ç”¨æˆ·å: `testuser`
- å¯†ç : `123456`

## ğŸ“Š ç³»ç»Ÿæ¶æ„
```
å‰ç«¯ (localhost:3000)
    â†“ Next.jsä»£ç†
åç«¯ (localhost:8001)
    â†“
ç”¨æˆ·æ•°æ® (user_data.json)
```

## ğŸ’¡ å»ºè®®
1. **ä½¿ç”¨Next.jsä»£ç†** æ˜¯è§£å†³CORSé—®é¢˜çš„æœ€ä½³æ–¹æ¡ˆ
2. **ç®€åŒ–åç«¯CORSé…ç½®** é¿å…å¤æ‚çš„ä¸­é—´ä»¶å†²çª
3. **å¢å¼ºé”™è¯¯å¤„ç†** ç¡®ä¿APIå§‹ç»ˆè¿”å›JSONæ ¼å¼çš„å“åº”
4. **æ·»åŠ è¯¦ç»†æ—¥å¿—** ä¾¿äºé—®é¢˜è¯Šæ–­å’Œè°ƒè¯• 