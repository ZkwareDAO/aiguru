# Phase 2 å®æ–½è®¡åˆ’ - å‰ç«¯é›†æˆä¸å®Œæ•´æµ‹è¯•

**è®¡åˆ’æ—¥æœŸ**: 2025-10-05  
**é¢„è®¡å·¥æœŸ**: 2å‘¨ (10ä¸ªå·¥ä½œæ—¥)  
**ç›®æ ‡**: å°†Agentæ‰¹æ”¹ç³»ç»Ÿé›†æˆåˆ°å‰ç«¯ï¼Œå®ç°å®Œæ•´çš„ç”¨æˆ·ä½“éªŒ  

---

## ğŸ“‹ Phase 2 ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
1. âœ… **å‰ç«¯é›†æˆ** - åˆ›å»ºæ‰¹æ”¹ç›¸å…³çš„å‰ç«¯é¡µé¢
2. âœ… **å®æ—¶åé¦ˆ** - WebSocketå®æ—¶è¿›åº¦æ›´æ–°
3. âœ… **æ•°æ®åº“é›†æˆ** - ç¡®ä¿æ•°æ®æ­£ç¡®å­˜å‚¨å’ŒæŸ¥è¯¢
4. âœ… **å®Œæ•´æµ‹è¯•** - ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
5. âœ… **ç”¨æˆ·ä½“éªŒä¼˜åŒ–** - æµç•…çš„äº¤äº’ä½“éªŒ

### æˆåŠŸæ ‡å‡†
- [ ] ç”¨æˆ·å¯ä»¥é€šè¿‡å‰ç«¯æäº¤ä½œä¸šæ‰¹æ”¹
- [ ] å®æ—¶æ˜¾ç¤ºæ‰¹æ”¹è¿›åº¦
- [ ] æ‰¹æ”¹ç»“æœæ­£ç¡®æ˜¾ç¤ºå’Œå­˜å‚¨
- [ ] æ”¯æŒæŸ¥çœ‹å†å²æ‰¹æ”¹è®°å½•
- [ ] å“åº”æ—¶é—´ < 15ç§’
- [ ] ç”¨æˆ·ä½“éªŒæµç•…

---

## ğŸ—“ï¸ è¯¦ç»†æ—¶é—´è¡¨

### Week 1: åç«¯å®Œå–„ä¸APIé›†æˆ

#### Day 1-2: æ•°æ®åº“é›†æˆä¸æµ‹è¯•
**ç›®æ ‡**: ç¡®ä¿æ‰¹æ”¹ç»“æœæ­£ç¡®å­˜å‚¨åˆ°æ•°æ®åº“

**ä»»åŠ¡**:
1. æ£€æŸ¥ç°æœ‰æ•°æ®åº“æ¨¡å‹
2. æ›´æ–°Submissionæ¨¡å‹ä»¥æ”¯æŒAgentæ‰¹æ”¹ç»“æœ
3. åˆ›å»ºæ‰¹æ”¹ç»“æœå­˜å‚¨æœåŠ¡
4. æµ‹è¯•æ•°æ®åº“è¯»å†™

**äº§å‡º**:
- [ ] æ›´æ–°çš„æ•°æ®åº“æ¨¡å‹
- [ ] æ‰¹æ”¹ç»“æœå­˜å‚¨æœåŠ¡
- [ ] æ•°æ®åº“é›†æˆæµ‹è¯•

---

#### Day 3-4: WebSocketå®æ—¶é€šçŸ¥
**ç›®æ ‡**: å®ç°æ‰¹æ”¹è¿›åº¦çš„å®æ—¶æ¨é€

**ä»»åŠ¡**:
1. æ£€æŸ¥ç°æœ‰WebSocketå®ç°
2. æ·»åŠ æ‰¹æ”¹è¿›åº¦äº‹ä»¶
3. å®ç°è¿›åº¦æ¨é€é€»è¾‘
4. æµ‹è¯•WebSocketè¿æ¥

**äº§å‡º**:
- [ ] WebSocketè¿›åº¦æ¨é€
- [ ] è¿›åº¦äº‹ä»¶å®šä¹‰
- [ ] WebSocketæµ‹è¯•

---

#### Day 5: APIå®Œå–„ä¸æ–‡æ¡£
**ç›®æ ‡**: å®Œå–„APIæ¥å£ï¼Œç”Ÿæˆæ–‡æ¡£

**ä»»åŠ¡**:
1. å®Œå–„grading_v2 API
2. æ·»åŠ é”™è¯¯å¤„ç†
3. ç”ŸæˆAPIæ–‡æ¡£
4. ç¼–å†™APIä½¿ç”¨ç¤ºä¾‹

**äº§å‡º**:
- [ ] å®Œå–„çš„APIæ¥å£
- [ ] APIæ–‡æ¡£
- [ ] ä½¿ç”¨ç¤ºä¾‹

---

### Week 2: å‰ç«¯å¼€å‘ä¸æµ‹è¯•

#### Day 6-7: å‰ç«¯é¡µé¢å¼€å‘
**ç›®æ ‡**: åˆ›å»ºæ‰¹æ”¹ç›¸å…³çš„å‰ç«¯é¡µé¢

**ä»»åŠ¡**:
1. åˆ›å»ºä½œä¸šæäº¤é¡µé¢
2. åˆ›å»ºæ‰¹æ”¹è¿›åº¦é¡µé¢
3. åˆ›å»ºæ‰¹æ”¹ç»“æœé¡µé¢
4. åˆ›å»ºå†å²è®°å½•é¡µé¢

**äº§å‡º**:
- [ ] ä½œä¸šæäº¤é¡µé¢
- [ ] æ‰¹æ”¹è¿›åº¦é¡µé¢
- [ ] æ‰¹æ”¹ç»“æœé¡µé¢
- [ ] å†å²è®°å½•é¡µé¢

---

#### Day 8: å‰ç«¯APIé›†æˆ
**ç›®æ ‡**: è¿æ¥å‰ç«¯ä¸åç«¯API

**ä»»åŠ¡**:
1. åˆ›å»ºAPIå®¢æˆ·ç«¯
2. å®ç°æ•°æ®è·å–é€»è¾‘
3. å®ç°WebSocketè¿æ¥
4. å¤„ç†é”™è¯¯å’ŒåŠ è½½çŠ¶æ€

**äº§å‡º**:
- [ ] APIå®¢æˆ·ç«¯
- [ ] æ•°æ®è·å–hooks
- [ ] WebSocketé›†æˆ
- [ ] é”™è¯¯å¤„ç†

---

#### Day 9: ç«¯åˆ°ç«¯æµ‹è¯•
**ç›®æ ‡**: å®Œæ•´æµç¨‹æµ‹è¯•

**ä»»åŠ¡**:
1. æµ‹è¯•å®Œæ•´æ‰¹æ”¹æµç¨‹
2. æµ‹è¯•å®æ—¶è¿›åº¦æ›´æ–°
3. æµ‹è¯•é”™è¯¯å¤„ç†
4. æ€§èƒ½æµ‹è¯•

**äº§å‡º**:
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•æŠ¥å‘Š
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- [ ] Bugä¿®å¤åˆ—è¡¨

---

#### Day 10: ä¼˜åŒ–ä¸éƒ¨ç½²å‡†å¤‡
**ç›®æ ‡**: ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œå‡†å¤‡éƒ¨ç½²

**ä»»åŠ¡**:
1. UI/UXä¼˜åŒ–
2. æ€§èƒ½ä¼˜åŒ–
3. æ–‡æ¡£å®Œå–„
4. éƒ¨ç½²å‡†å¤‡

**äº§å‡º**:
- [ ] ä¼˜åŒ–åçš„ç•Œé¢
- [ ] éƒ¨ç½²æ–‡æ¡£
- [ ] ç”¨æˆ·æ‰‹å†Œ

---

## ğŸ¯ è¯¦ç»†å®æ–½æ–¹æ¡ˆ

### 1. æ•°æ®åº“é›†æˆ (Day 1-2)

#### 1.1 æ£€æŸ¥ç°æœ‰æ¨¡å‹

éœ€è¦æ£€æŸ¥çš„æ¨¡å‹:
- `Submission` - ä½œä¸šæäº¤
- `Assignment` - ä½œä¸š
- `GradingResult` - æ‰¹æ”¹ç»“æœ (å¯èƒ½éœ€è¦æ–°å¢)

#### 1.2 æ›´æ–°Submissionæ¨¡å‹

```python
# app/models/submission.py
class Submission(Base):
    __tablename__ = "submissions"
    
    # ç°æœ‰å­—æ®µ...
    
    # æ–°å¢Agentæ‰¹æ”¹ç›¸å…³å­—æ®µ
    agent_grading_status: str = Column(String, default="pending")
    agent_grading_mode: str = Column(String, nullable=True)
    agent_score: float = Column(Float, nullable=True)
    agent_confidence: float = Column(Float, nullable=True)
    agent_errors: JSON = Column(JSON, nullable=True)
    agent_feedback: Text = Column(Text, nullable=True)
    agent_suggestions: JSON = Column(JSON, nullable=True)
    agent_knowledge_points: JSON = Column(JSON, nullable=True)
    agent_processing_time_ms: int = Column(Integer, nullable=True)
    agent_graded_at: DateTime = Column(DateTime, nullable=True)
```

#### 1.3 åˆ›å»ºæ‰¹æ”¹ç»“æœå­˜å‚¨æœåŠ¡

```python
# app/services/grading_result_service.py
class GradingResultService:
    """æ‰¹æ”¹ç»“æœå­˜å‚¨æœåŠ¡"""
    
    async def save_grading_result(
        self,
        submission_id: UUID,
        result: GradingState
    ) -> Submission:
        """ä¿å­˜æ‰¹æ”¹ç»“æœåˆ°æ•°æ®åº“"""
        submission = await self.db.get(Submission, submission_id)
        
        submission.agent_grading_status = result["status"]
        submission.agent_score = result["score"]
        submission.agent_confidence = result["confidence"]
        submission.agent_errors = result["errors"]
        submission.agent_feedback = result["feedback_text"]
        submission.agent_suggestions = result["suggestions"]
        submission.agent_knowledge_points = result["knowledge_points"]
        submission.agent_processing_time_ms = result["processing_time_ms"]
        submission.agent_graded_at = datetime.now(UTC)
        
        await self.db.commit()
        return submission
```

---

### 2. WebSocketå®æ—¶é€šçŸ¥ (Day 3-4)

#### 2.1 è¿›åº¦äº‹ä»¶å®šä¹‰

```python
# app/schemas/websocket.py
class GradingProgressEvent(BaseModel):
    """æ‰¹æ”¹è¿›åº¦äº‹ä»¶"""
    type: str = "grading_progress"
    submission_id: str
    status: str  # preprocessing, grading, reviewing, completed, failed
    progress: int  # 0-100
    message: str
    timestamp: datetime
```

#### 2.2 WebSocketæ¨é€å®ç°

```python
# app/api/v1/grading_v2.py
async def grade_with_progress(
    submission_id: UUID,
    websocket_manager: WebSocketManager
):
    """å¸¦è¿›åº¦æ¨é€çš„æ‰¹æ”¹"""
    
    # 1. é¢„å¤„ç†é˜¶æ®µ
    await websocket_manager.send_to_user(
        user_id,
        {
            "type": "grading_progress",
            "submission_id": str(submission_id),
            "status": "preprocessing",
            "progress": 20,
            "message": "æ­£åœ¨å¤„ç†æ–‡ä»¶..."
        }
    )
    
    # 2. æ‰¹æ”¹é˜¶æ®µ
    await websocket_manager.send_to_user(
        user_id,
        {
            "type": "grading_progress",
            "submission_id": str(submission_id),
            "status": "grading",
            "progress": 60,
            "message": "æ­£åœ¨æ‰¹æ”¹..."
        }
    )
    
    # 3. å®Œæˆ
    await websocket_manager.send_to_user(
        user_id,
        {
            "type": "grading_progress",
            "submission_id": str(submission_id),
            "status": "completed",
            "progress": 100,
            "message": "æ‰¹æ”¹å®Œæˆ!"
        }
    )
```

---

### 3. å‰ç«¯é¡µé¢å¼€å‘ (Day 6-7)

#### 3.1 é¡µé¢ç»“æ„

```
frontend/app/
â”œâ”€â”€ (dashboard)/
â”‚   â”œâ”€â”€ assignments/
â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â”œâ”€â”€ page.tsx          # ä½œä¸šè¯¦æƒ…
â”‚   â”‚       â””â”€â”€ submit/
â”‚   â”‚           â””â”€â”€ page.tsx      # æäº¤ä½œä¸š
â”‚   â””â”€â”€ submissions/
â”‚       â””â”€â”€ [id]/
â”‚           â”œâ”€â”€ page.tsx          # æ‰¹æ”¹ç»“æœ
â”‚           â””â”€â”€ grading/
â”‚               â””â”€â”€ page.tsx      # æ‰¹æ”¹è¿›åº¦
```

#### 3.2 ä½œä¸šæäº¤é¡µé¢

```typescript
// app/(dashboard)/assignments/[id]/submit/page.tsx
export default function SubmitAssignmentPage() {
  const [files, setFiles] = useState<File[]>([]);
  const [isSubmitting, setIsSubmitting] = useState(false);
  
  const handleSubmit = async () => {
    setIsSubmitting(true);
    
    // 1. ä¸Šä¼ æ–‡ä»¶
    const uploadedFiles = await uploadFiles(files);
    
    // 2. åˆ›å»ºæäº¤
    const submission = await createSubmission({
      assignment_id,
      files: uploadedFiles
    });
    
    // 3. è§¦å‘æ‰¹æ”¹
    await triggerGrading(submission.id);
    
    // 4. è·³è½¬åˆ°è¿›åº¦é¡µé¢
    router.push(`/submissions/${submission.id}/grading`);
  };
  
  return (
    <div>
      <h1>æäº¤ä½œä¸š</h1>
      <FileUpload onChange={setFiles} />
      <Button onClick={handleSubmit} disabled={isSubmitting}>
        æäº¤å¹¶æ‰¹æ”¹
      </Button>
    </div>
  );
}
```

#### 3.3 æ‰¹æ”¹è¿›åº¦é¡µé¢

```typescript
// app/(dashboard)/submissions/[id]/grading/page.tsx
export default function GradingProgressPage() {
  const [progress, setProgress] = useState(0);
  const [status, setStatus] = useState("pending");
  const [message, setMessage] = useState("");
  
  useEffect(() => {
    // è¿æ¥WebSocket
    const ws = connectWebSocket();
    
    ws.on("grading_progress", (data) => {
      setProgress(data.progress);
      setStatus(data.status);
      setMessage(data.message);
      
      if (data.status === "completed") {
        router.push(`/submissions/${submissionId}`);
      }
    });
    
    return () => ws.disconnect();
  }, []);
  
  return (
    <div>
      <h1>æ‰¹æ”¹ä¸­...</h1>
      <ProgressBar value={progress} />
      <p>{message}</p>
      <StatusIndicator status={status} />
    </div>
  );
}
```

#### 3.4 æ‰¹æ”¹ç»“æœé¡µé¢

```typescript
// app/(dashboard)/submissions/[id]/page.tsx
export default function SubmissionResultPage() {
  const { data: result } = useQuery({
    queryKey: ["submission", submissionId],
    queryFn: () => fetchSubmission(submissionId)
  });
  
  return (
    <div>
      <h1>æ‰¹æ”¹ç»“æœ</h1>
      
      {/* åˆ†æ•°å¡ç‰‡ */}
      <ScoreCard 
        score={result.agent_score}
        maxScore={result.max_score}
        confidence={result.agent_confidence}
      />
      
      {/* é”™è¯¯åˆ—è¡¨ */}
      <ErrorList errors={result.agent_errors} />
      
      {/* æ€»ä½“åé¦ˆ */}
      <FeedbackSection feedback={result.agent_feedback} />
      
      {/* æ”¹è¿›å»ºè®® */}
      <SuggestionsList suggestions={result.agent_suggestions} />
      
      {/* çŸ¥è¯†ç‚¹åˆ†æ */}
      <KnowledgePointsChart points={result.agent_knowledge_points} />
    </div>
  );
}
```

---

## ğŸ“Š æŠ€æœ¯æ ˆ

### åç«¯
- FastAPI - Webæ¡†æ¶
- SQLAlchemy - ORM
- WebSocket - å®æ—¶é€šä¿¡
- LangGraph - Agentç¼–æ’

### å‰ç«¯
- Next.js 14 - Reactæ¡†æ¶
- TypeScript - ç±»å‹å®‰å…¨
- TanStack Query - æ•°æ®è·å–
- Socket.io - WebSocketå®¢æˆ·ç«¯
- Tailwind CSS - æ ·å¼
- shadcn/ui - UIç»„ä»¶

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] ç”¨æˆ·å¯ä»¥æäº¤ä½œä¸šå¹¶è§¦å‘æ‰¹æ”¹
- [ ] å®æ—¶æ˜¾ç¤ºæ‰¹æ”¹è¿›åº¦
- [ ] æ‰¹æ”¹ç»“æœæ­£ç¡®æ˜¾ç¤º
- [ ] æ”¯æŒæŸ¥çœ‹å†å²è®°å½•
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### æ€§èƒ½éªŒæ”¶
- [ ] æ‰¹æ”¹æ—¶é—´ < 15ç§’
- [ ] APIå“åº”æ—¶é—´ < 500ms
- [ ] WebSocketå»¶è¿Ÿ < 100ms
- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’

### ç”¨æˆ·ä½“éªŒéªŒæ”¶
- [ ] ç•Œé¢ç¾è§‚
- [ ] äº¤äº’æµç•…
- [ ] åé¦ˆåŠæ—¶
- [ ] é”™è¯¯æç¤ºæ¸…æ™°

---

## ğŸ¯ Phase 2 å®Œæˆæ ‡å‡†

1. âœ… æ‰€æœ‰å‰ç«¯é¡µé¢å¼€å‘å®Œæˆ
2. âœ… æ•°æ®åº“é›†æˆæµ‹è¯•é€šè¿‡
3. âœ… WebSocketå®æ—¶é€šçŸ¥æ­£å¸¸
4. âœ… ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
5. âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
6. âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½

---

**è®¡åˆ’åˆ¶å®šæ—¶é—´**: 2025-10-05  
**é¢„è®¡å¼€å§‹æ—¶é—´**: 2025-10-05  
**é¢„è®¡å®Œæˆæ—¶é—´**: 2025-10-19  
**çŠ¶æ€**: å¾…å¼€å§‹

