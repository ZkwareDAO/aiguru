# AI自动批改系统 - 需求文档 v3.0

## 📌 文档概述

**项目名称**: 智能教育批改系统 (AI Grading System)  
**版本**: 3.0  
**日期**: 2025-10-05  
**技术栈**: FastAPI + Next.js + LangChain/LangGraph + PostgreSQL + Redis

---

## 1. 系统概述与目标

### 1.1 系统愿景
构建一个基于LangChain/LangGraph的智能批改系统,通过多Agent协作实现高效、准确、可扩展的作业批改服务,为教师减负,为学生提供即时、详细的学习反馈。

### 1.2 核心目标
- **高效性**: 支持大规模并发批改,单次可处理100+份作业
- **准确性**: 通过多Agent协作和审核机制,确保批改质量
- **可扩展性**: 模块化设计,易于添加新的批改类型和学科
- **用户体验**: 实时反馈、可视化展示、交互式批改结果
- **可靠性**: 完善的错误处理、重试机制、数据一致性保证

### 1.3 系统边界
**包含功能**:
- 作业提交与管理
- AI智能批改(文本、图片、文档)
- 批改结果可视化(坐标标注、局部图卡片)
- 批量批改与任务调度
- 学习分析与个性化建议
- 实时通知与进度追踪

**不包含功能**:
- 在线考试监考
- 视频课程播放
- 支付系统
- 社交功能

---

## 2. 用户角色与需求

### 2.1 教师 (Teacher)

#### 核心需求
1. **作业管理**
   - 创建作业:设置标题、描述、截止日期、评分标准
   - 批量导入学生名单
   - 设置批改模板和评分规则
   - 查看作业统计(提交率、平均分、完成情况)

2. **批改管理**
   - 一键批量批改所有提交
   - 查看批改进度(实时更新)
   - 审核AI批改结果
   - 手动调整分数和评语
   - 导出批改报告(PDF/Excel)

3. **结果分析**
   - 班级整体表现分析
   - 学生个体进步追踪
   - 知识点掌握情况统计
   - 错误类型分布分析

4. **质量控制**
   - 设置批改严格度(宽松/标准/严格)
   - 自定义批改指令
   - 批改结果抽查
   - 批改质量评分

#### 用户故事
```
作为教师,我希望:
- 能够在5分钟内完成100份作业的批改任务设置
- 实时看到批改进度,而不是等待全部完成
- 对AI批改结果有最终审核权
- 能够导出详细的批改报告用于家长会
- 系统能自动识别常见错误并给出针对性建议
```

### 2.2 学生 (Student)

#### 核心需求
1. **作业提交**
   - 查看待完成作业列表
   - 上传作业文件(图片/PDF/文档)
   - 查看提交历史
   - 补交逾期作业

2. **结果查看**
   - 查看批改结果(分数、评语、错误标注)
   - 交互式查看错误位置
   - 查看知识点关联
   - 查看改进建议

3. **学习追踪**
   - 查看个人成绩趋势
   - 查看薄弱知识点
   - 获取个性化学习建议
   - 查看进步排名

4. **反馈互动**
   - 对批改结果提问
   - 申请人工复核
   - 查看详细解析

#### 用户故事
```
作为学生,我希望:
- 提交作业后能在10分钟内收到批改结果
- 能清楚看到每个错误的具体位置和原因
- 获得针对性的改进建议,而不只是分数
- 能追踪自己的学习进步
- 对不理解的批改能提出疑问
```

### 2.3 系统管理员 (Admin)

#### 核心需求
1. **系统监控**
   - 批改任务队列状态
   - Agent运行状态
   - API调用统计
   - 系统性能指标

2. **配置管理**
   - AI模型配置
   - 批改模板管理
   - 系统参数调优
   - 限流规则设置

3. **数据管理**
   - 数据备份与恢复
   - 日志查询与分析
   - 异常任务处理
   - 数据清理

---

## 3. 核心功能需求

### 3.1 作业管理模块

#### F1.1 作业创建
- **输入**: 标题、描述、截止日期、附件、评分标准、批改指令
- **处理**: 数据验证、存储、通知学生
- **输出**: 作业ID、创建确认

#### F1.2 作业提交
- **输入**: 作业ID、学生ID、提交文件
- **处理**: 文件上传、格式验证、存储、触发批改
- **输出**: 提交ID、预计批改时间

#### F1.3 批量导入
- **输入**: Excel文件(学生名单、作业信息)
- **处理**: 数据解析、验证、批量创建
- **输出**: 导入结果报告

### 3.2 AI批改模块 (核心)

#### F2.1 单份批改
```python
输入:
- submission_id: UUID
- grading_standard: 评分标准文本
- grading_instructions: 批改指令
- files: 学生提交的文件列表

处理流程:
1. 文件预处理(OCR、格式转换)
2. 调用GradingAgent进行批改
3. 调用ReviewAgent进行审核
4. 生成批改结果(分数、评语、错误标注)
5. 存储结果并通知学生

输出:
- score: 分数
- feedback: 评语
- error_annotations: 错误标注列表
- knowledge_points: 关联知识点
- suggestions: 改进建议
```

#### F2.2 批量批改
```python
输入:
- assignment_id: UUID
- submission_ids: List[UUID]
- batch_config: 批量配置

处理流程:
1. 创建批量任务
2. 分配到任务队列(按优先级)
3. 并发处理(限流控制)
4. 实时更新进度
5. 汇总结果

输出:
- batch_id: 批量任务ID
- total_count: 总数
- completed_count: 完成数
- failed_count: 失败数
- results: 批改结果列表
```

#### F2.3 可视化批改
- **坐标标注模式**: 在原图上标注错误位置
- **局部图卡片模式**: 裁剪错误区域,卡片式展示
- **交互功能**: 点击查看详情、缩放、拖拽

### 3.3 任务调度模块

#### F3.1 任务队列
- **优先级队列**: URGENT > HIGH > NORMAL > LOW
- **并发控制**: 最大并发数可配置
- **超时处理**: 任务超时自动重试
- **失败重试**: 指数退避策略

#### F3.2 任务监控
- **实时状态**: PENDING, PROCESSING, COMPLETED, FAILED
- **进度追踪**: 百分比、预计剩余时间
- **性能指标**: 处理速度、成功率、平均耗时

### 3.4 学习分析模块

#### F4.1 个人分析
- 成绩趋势图
- 知识点掌握雷达图
- 错误类型分布
- 学习时间统计

#### F4.2 班级分析
- 整体成绩分布
- 优秀/待提高学生识别
- 共性问题分析
- 教学效果评估

---

## 4. 非功能性需求

### 4.1 性能需求
- **响应时间**: 
  - 单份批改: < 30秒
  - 批量批改(100份): < 10分钟
  - 页面加载: < 2秒
  - API响应: < 500ms

- **并发能力**:
  - 支持100+并发批改任务
  - 支持1000+在线用户
  - 支持10000+日活跃用户

- **吞吐量**:
  - 批改速度: 10份/分钟
  - API QPS: 1000+

### 4.2 可靠性需求
- **可用性**: 99.9% (年停机时间 < 8.76小时)
- **数据持久性**: 99.999%
- **错误率**: < 0.1%
- **恢复时间**: < 5分钟

### 4.3 可扩展性需求
- **水平扩展**: 支持增加Worker节点
- **模块化设计**: 易于添加新Agent
- **插件化**: 支持自定义批改逻辑
- **多租户**: 支持多学校/机构隔离

### 4.4 安全性需求
- **认证**: JWT Token + Refresh Token
- **授权**: RBAC权限控制
- **数据加密**: 传输加密(HTTPS) + 存储加密
- **隐私保护**: 学生数据脱敏、访问日志

### 4.5 可维护性需求
- **日志**: 结构化日志、分级记录
- **监控**: 实时监控、告警通知
- **文档**: API文档、架构文档、运维文档
- **测试**: 单元测试覆盖率 > 80%

---

## 5. 技术约束

### 5.1 技术栈约束
- **后端**: Python 3.11+, FastAPI
- **前端**: Next.js 14+, React 18+, TypeScript
- **AI框架**: LangChain, LangGraph
- **数据库**: PostgreSQL 15+
- **缓存**: Redis 7+
- **消息队列**: Redis Streams / Celery

### 5.2 外部依赖
- **AI模型**: OpenRouter API (Gemini 2.5 Flash Lite)
- **文件存储**: 本地存储 / S3兼容存储
- **OCR服务**: 内置OCR / 第三方API

### 5.3 部署约束
- **容器化**: Docker + Docker Compose
- **云平台**: Railway / Vercel / 自建服务器
- **CI/CD**: GitHub Actions

---

## 6. 成功标准

### 6.1 业务指标
- 教师批改时间减少 80%
- 学生获得反馈时间从 3天 缩短到 10分钟
- 批改准确率 > 90%
- 用户满意度 > 4.5/5

### 6.2 技术指标
- 系统可用性 > 99.9%
- 批改成功率 > 99%
- 平均响应时间 < 500ms
- 并发处理能力 > 100任务

### 6.3 用户体验指标
- 页面加载时间 < 2秒
- 批改结果可视化清晰度 > 4/5
- 操作流程简便度 > 4.5/5
- 移动端适配完整度 > 90%

---

## 7. 风险与挑战

### 7.1 技术风险
- **AI模型稳定性**: OpenRouter API可能不稳定
  - **缓解**: 实现重试机制、备用模型、本地缓存
  
- **并发处理复杂性**: 高并发下的数据一致性
  - **缓解**: 使用分布式锁、事务管理、幂等性设计

- **文件处理性能**: 大文件上传和处理
  - **缓解**: 分片上传、异步处理、CDN加速

### 7.2 业务风险
- **批改准确性**: AI批改可能出错
  - **缓解**: 人工审核机制、置信度评分、用户反馈

- **用户接受度**: 教师可能不信任AI批改
  - **缓解**: 透明化批改过程、提供调整权限、渐进式推广

### 7.3 运营风险
- **成本控制**: AI API调用成本
  - **缓解**: 智能缓存、批量处理、成本监控

- **数据安全**: 学生作业数据泄露
  - **缓解**: 加密存储、访问控制、安全审计

---

## 8. 项目里程碑

### Phase 1: 基础架构 (2周)
- [ ] LangGraph Agent架构设计
- [ ] 数据库模型设计
- [ ] 基础API开发
- [ ] 前端框架搭建

### Phase 2: 核心功能 (4周)
- [ ] 单份批改功能
- [ ] 批量批改功能
- [ ] 任务队列系统
- [ ] 可视化展示

### Phase 3: 高级功能 (3周)
- [ ] 学习分析
- [ ] 个性化建议
- [ ] 实时通知
- [ ] 数据导出

### Phase 4: 优化与测试 (2周)
- [ ] 性能优化
- [ ] 压力测试
- [ ] 安全加固
- [ ] 文档完善

### Phase 5: 上线与运维 (1周)
- [ ] 生产环境部署
- [ ] 监控告警配置
- [ ] 用户培训
- [ ] 持续优化

---

## 9. 附录

### 9.1 术语表
- **Agent**: LangChain中的智能代理,负责特定任务
- **LangGraph**: LangChain的图形化工作流框架
- **批改标准**: 教师设定的评分规则和要求
- **坐标标注**: 在原图上标记错误位置的可视化方式
- **局部图卡片**: 裁剪错误区域并以卡片形式展示

### 9.2 参考文档
- LangChain官方文档: https://python.langchain.com/
- LangGraph文档: https://langchain-ai.github.io/langgraph/
- FastAPI文档: https://fastapi.tiangolo.com/
- Next.js文档: https://nextjs.org/docs

---

**文档状态**: ✅ 已完成  
**下一步**: 查看 `02_AGENT_ARCHITECTURE_DESIGN.md` 了解Agent架构设计

